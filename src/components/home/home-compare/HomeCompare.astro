---
const { label, title, compare_list } = Astro.props;

import { Image } from 'astro:assets';
import { getByUID } from '../../../prismic';
import comparePlates from '../../../assets/compare.png';
import compareDotDash from '../../../assets/compare-dot-dash.svg';
import compareLine from '../../../assets/compare-line.svg?raw';
import compareGood from '../../../assets/comp-good.svg';
import compareBad from '../../../assets/comp-bad.svg';

import HomeCompareLine from './HomeCompareLine.jsx';

const list = await Promise.all(
    compare_list.map(async (compare: any, idx: number) => {
        if (idx < 4) {
            let item = getByUID('compare', compare.item.uid)
            return item
        }
    })
)
---
<section class="home-comp">
    <div class="home-comp-stick">
        <div class="container">
            <div class="home-comp-title-wrap">
                <h2 class="heading txt-up txt-black home-comp-title">
                    <span class="h3">{label}</span><br>
                    <span class="h0">{title}</span>
                </h2>
            </div>
            <div class="home-comp-main grid">
                <div class="home-comp-main-item good">
                    <Image src={compareGood} alt="" class='ic ic-80' />
                    <h3 class="heading h5 txt-up txt-black home-comp-main-item-title good">
                        Kanak Naturals Plate
                    </h3>
                    <div class="home-comp-main-item-list">
                        {list.map((item, idx) => (
                            <p class:list={["txt txt-20 home-comp-main-item-list-item", {active: idx == 0}]}>
                                {item.data.kanak}
                            </p>
                        ))}
                    </div>
                </div>
                <div class="home-comp-main-prog">
                    <div class="home-comp-main-prog-inner">
                        <div class="home-comp-main-prog-plates">
                            <Image src={comparePlates} alt="Compare plates" class="img" />
                        </div>
                        <div class="home-comp-main-prog-dot">
                            <Image src={compareDotDash} alt="" class="img" />
                        </div>
                        <HomeCompareLine customClass=".home-comp-main-prog-line" client:visible >
                            <Fragment set:html={compareLine} alt="" class="img" slot="plateLine"/>
                        </HomeCompareLine>
                        <div class="home-comp-main-prog-list">
                            {list.map((item, idx) => (
                                <h4 class:list={["heading h3 txt-up txt-black home-comp-main-prog-list-item", {active: idx == 0}]}>
                                    {item.data.title}
                                </h4>
                            ))}
                        </div>
                    </div>
                </div>
                <div class="home-comp-main-item bad">
                    <Image src={compareBad} alt="" class='ic ic-80' />
                    <h3 class="heading h5 txt-up txt-black home-comp-main-item-title bad">
                        Traditional Styrofoam Plate
                    </h3>
                    <div class="home-comp-main-item-list">
                        {list.map((item, idx) => (
                            <p class:list={["txt txt-20 home-comp-main-item-list-item", {active: idx == 0}]}>
                                {item.data.other}
                            </p>
                        ))}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style lang="scss">
    @import '../../../styles/colors.scss';
    @import '../../../styles/mixins.scss';
    .home-comp {
        height: 400vh;
        position: relative;
        .container {
            display: flex;
            flex-direction: column;
            height: 100%;
            background-color: var(--cl-txt)FF;
        }
        &-stick {
            position: sticky;
            top: 0;
            height: 100vh;
        }
        &-title-wrap {
            padding-top: 16rem;
            margin-bottom: 8.2rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        &-title {
            width: 100%;
            margin: 0 auto;
        }
        &-main {
            grid-template-columns: repeat(16, 1fr);
            align-items: center;
            flex-grow: 1;
            padding-bottom: 10rem;
            &-item {
                display: flex;
                flex-direction: column;
                align-items: center;
                grid-column: span 4;
                text-align: center;
                max-width: 38.7rem;
                justify-self: center;
                .ic {
                    margin-bottom: 2rem;
                }
                &-title {
                    margin-bottom: 2rem;
                    &.good {
                        max-width: 28.4rem;
                    }
                    &-bad {
                        max-width: 32.5rem;
                    }
                }
                &-list {
                    padding: 0 2rem;
                    display: grid;
                    &-item {
                        grid-column: 1/2;
                        grid-row: 1/2;
                        opacity: 0;
                        @include transition(all 600ms ease);
                        &.active {
                            opacity: 1;
                        }
                    }
                }
            }
            &-prog {
                grid-column: span 8;
                padding-left: 6.2rem;
                padding-right: 6.2rem;
                display: flex;
                align-items: center;
                justify-content: center;
                &-inner {
                    width: calc(100vh - 16rem - 10rem - 8.2rem - var(--h0-fs) - var(--h3-fs));
                    position: relative;
                }
                &-plates {
                }
                &-dot {
                    z-index: 2;
                    position: absolute;
                    inset: 0;
                }
                &-line :global() {
                    z-index: 1;
                    position: absolute;
                    inset: 0rem;
                    --arcL: calc(2 * var(--PI) * 315);
                    --prog: 0;
                    --arcOffset: calc(var(--arcL) * (-1 * (var(--prog) - 100) / 100));
                    transform: rotate(-90deg);
                }
                :global(.home-comp-main-prog-line) {
                    z-index: 1;
                    position: absolute;
                    inset: 0rem;
                    --arcL: calc(2 * var(--PI) * 315);
                    --prog: 0;
                    --arcOffset: calc(var(--arcL) * (-1 * (var(--prog) - 100) / 100));
                    transform: rotate(-90deg);
                }
                &-list {
                    position: absolute;
                    inset: 0;
                    display: grid;
                    align-items: center;
                    justify-content: center;
                    &-item {
                        grid-column: 1/2;
                        grid-row: 1/2;
                        opacity: 0;
                        text-align: center;
                        max-width: 41rem;
                        @include transition(all 600ms ease);
                        @include transform(scale(.94));
                        &.active {
                            opacity: 1;
                            @include transform(scale(1));
                        }
                    }
                }
            }
        }
    }
</style>