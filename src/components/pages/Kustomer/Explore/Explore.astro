---
import "./Explore.scss";

import Image from "astro/components/Image.astro";
import { getByUID } from "@/prismic";
import KustomerExplore from "./Explore";
import ExploreItem from "./ExploreItem";

const listImage = await Promise.all(
    Astro.props.listGroup.reduce((acc, curr) => acc.concat(curr.image), []),
);

const listItems = await Promise.all(
    Astro.props.listItems.map(async (data: any) => {
        // Use Promise.all to await all inner asynchronous operations
        const items = await Promise.all(
            data.list.map(async (uid: any) => {
                const item = await getByUID("solution", uid);
                return item;
            }),
        );
        return { ...data, list: items };
    }),
);
console.log(listItems);
---

<KustomerExplore
    {...Astro.props}
    listImg={listImage}
    client:visible={{ rootMargin: "100% 0px 100% 0px" }}
>
    <Fragment slot="renderList">
        {
            listItems.map((item, idx) => (
                <ExploreItem key={item.uid} {...item}>
                    <Image
                        src={item.img.url}
                        alt=""
                        width={item.img.dimensions?.width}
                        height={item.img.dimensions?.height}
                        class="img img-fill"
                        slot="img"
                    />
                </ExploreItem>
            ))
        }
    </Fragment>
    <Fragment set:html={Astro.props.title} slot="title" />
</KustomerExplore>
