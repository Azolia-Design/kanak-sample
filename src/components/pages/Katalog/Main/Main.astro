---
import Image from "astro/components/Image.astro";
import { getAllByType, getByUID } from "@/prismic";
import KatalogMain from "./Main";

const allTag = await getAllByType("case_study");
const tagList = [];
allTag.map((el, idx) => {
    !tagList.includes(el.data.category) && tagList.push(el.data.category);
});

const allCate = await getAllByType("product_group");
const cateNotSustainable = [];
allCate.map(
    (item) =>
        item.data.is_sustainables_ == false && cateNotSustainable.push(item),
);
const cateList = cateNotSustainable.reduce(
    (acc, curr) => acc.concat(curr.data.name),
    [],
);
const listUIDItem = [];
cateNotSustainable
    .reduce((acc, curr) => acc.concat(curr.data.product_list), [])
    .map(({ product }) => listUIDItem.push(product.uid));

const productList = await Promise.all(
    listUIDItem.map(async (uid: any) => {
        let item = await getByUID("product", uid);
        return { ...item, cate: uid };
    }),
);
---

<KatalogMain
    tagList={tagList}
    cateList={cateList}
    allItem={productList}
    check={listUIDItem}
    client:visible
/>
